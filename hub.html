<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>APEX HUB ‚Äî Trading Intelligence</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#07090d;--bg2:#0c1018;--bg3:#101520;--bg4:#141b24;
  --border:#1a2535;--border2:#223040;
  --text:#c8d8e8;--text2:#7a8fa8;--text3:#3a4a5a;
  --green:#00e5a0;--green2:#00b87a;--green-dim:rgba(0,229,160,0.08);
  --red:#ff4060;--red-dim:rgba(255,64,96,0.08);
  --blue:#3a9ef8;--blue-dim:rgba(58,158,248,0.08);
  --yellow:#f5c842;--orange:#ff8c42;--purple:#a78bfa;
  --radius:2px;
}
*{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;}
body{background:var(--bg);color:var(--text);font-family:'Syne',sans-serif;min-height:100vh;overflow-x:hidden;}

/* grid bg */
body::before{
  content:'';position:fixed;inset:0;
  background-image:
    linear-gradient(rgba(58,158,248,0.025) 1px,transparent 1px),
    linear-gradient(90deg,rgba(58,158,248,0.025) 1px,transparent 1px);
  background-size:44px 44px;pointer-events:none;z-index:0;
}

.z1{position:relative;z-index:1;}
.container{max-width:1720px;margin:0 auto;padding:0 20px;}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
header{
  border-bottom:1px solid var(--border);
  padding:11px 0;
  position:sticky;top:0;
  background:rgba(7,9,13,0.96);
  backdrop-filter:blur(16px);
  z-index:200;
}
.header-inner{display:flex;align-items:center;gap:16px;}
.logo{display:flex;align-items:center;gap:10px;text-decoration:none;}
.logo-box{
  width:32px;height:32px;
  border:1.5px solid var(--green);
  display:flex;align-items:center;justify-content:center;
  font-family:'Space Mono',monospace;font-size:11px;color:var(--green);
  position:relative;
}
.logo-box::after{content:'';position:absolute;inset:4px;background:var(--green);opacity:0.07;}
.logo-name{font-size:15px;font-weight:800;letter-spacing:.1em;color:var(--text);}
.logo-name span{color:var(--green);}
.logo-ver{font-family:'Space Mono',monospace;font-size:9px;color:var(--text3);border:1px solid var(--border2);padding:1px 5px;margin-left:4px;}

.header-sep{width:1px;height:20px;background:var(--border);flex-shrink:0;}

/* live pill */
.live-pill{display:flex;align-items:center;gap:6px;font-family:'Space Mono',monospace;font-size:9px;color:var(--green);}
.live-dot{width:5px;height:5px;border-radius:50%;background:var(--green);animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{opacity:1;box-shadow:0 0 0 0 rgba(0,229,160,.4)}50%{opacity:.6;box-shadow:0 0 0 5px rgba(0,229,160,0)}}

#clock{font-family:'Space Mono',monospace;font-size:9px;color:var(--text3);}

.conn-pill{display:flex;align-items:center;gap:5px;font-family:'Space Mono',monospace;font-size:9px;}
#connDot{width:5px;height:5px;border-radius:50%;background:var(--yellow);transition:background .3s;}
#connLabel{color:var(--yellow);transition:color .3s;}

.header-right{margin-left:auto;display:flex;align-items:center;gap:6px;}
.nav-btn{
  padding:5px 11px;
  font-family:'Space Mono',monospace;font-size:9px;letter-spacing:.06em;
  border:1px solid var(--border);background:transparent;color:var(--text2);
  cursor:pointer;transition:all .18s;white-space:nowrap;
}
.nav-btn:hover{border-color:var(--border2);color:var(--text);}
.nav-btn.active{border-color:var(--green);color:var(--green);background:var(--green-dim);}

/* ‚îÄ‚îÄ ASSET BAR ‚îÄ‚îÄ */
.asset-bar-wrap{border-bottom:1px solid var(--border);background:var(--bg2);}
.asset-bar{display:flex;gap:3px;overflow-x:auto;scrollbar-width:none;padding:8px 20px;}
.asset-bar::-webkit-scrollbar{display:none;}
.a-pill{
  display:flex;align-items:center;gap:6px;
  padding:5px 12px;border:1px solid var(--border);background:var(--bg);
  font-family:'Space Mono',monospace;font-size:10px;color:var(--text2);
  cursor:pointer;white-space:nowrap;transition:all .18s;flex-shrink:0;
}
.a-pill:hover{border-color:var(--border2);color:var(--text);}
.a-pill.active{border-color:var(--green);color:var(--green);background:var(--green-dim);}
.a-pill.active.bear{border-color:var(--red);color:var(--red);background:var(--red-dim);}
.a-badge{font-size:8px;padding:1px 4px;font-family:'Space Mono',monospace;}
.ab-bull{background:rgba(0,229,160,.1);color:var(--green);}
.ab-bear{background:rgba(255,64,96,.1);color:var(--red);}
.ab-neu{background:rgba(122,143,168,.08);color:var(--text3);}
.a-tf{font-size:8px;color:var(--text3);border-left:1px solid var(--border);padding-left:6px;}

/* ‚îÄ‚îÄ VIEWS ‚îÄ‚îÄ */
.view{display:none;}.view.active{display:block;}

/* ‚îÄ‚îÄ PANELS ‚îÄ‚îÄ */
.panel{background:var(--bg2);border:1px solid var(--border);}
.panel-hdr{
  display:flex;align-items:center;justify-content:space-between;
  padding:10px 14px;border-bottom:1px solid var(--border);
}
.ph-title{
  display:flex;align-items:center;gap:7px;
  font-size:9px;font-weight:700;letter-spacing:.12em;color:var(--text2);text-transform:uppercase;
  font-family:'Space Mono',monospace;
}
.ph-dot{width:5px;height:5px;border-radius:50%;}
.panel-body{padding:14px;}

/* ‚îÄ‚îÄ DASHBOARD GRID ‚îÄ‚îÄ */
.dash-grid{
  display:grid;
  grid-template-columns:280px 1fr 270px;
  gap:12px;
  padding:12px 0;
}

/* ‚îÄ‚îÄ LEFT PANEL: SCORE + TFs ‚îÄ‚îÄ */
.tf-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;margin-bottom:10px;}
.tf-card{
  background:var(--bg3);border:1px solid var(--border);
  padding:10px 7px;text-align:center;position:relative;overflow:hidden;
}
.tf-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;}
.tf-card.bull::before{background:var(--green);}
.tf-card.bear::before{background:var(--red);}
.tf-card.neu::before{background:var(--text3);}
.tf-role{font-size:7px;letter-spacing:.1em;color:var(--text3);font-family:'Space Mono',monospace;margin-bottom:4px;text-transform:uppercase;}
.tf-val{font-size:17px;font-weight:800;font-family:'Space Mono',monospace;}
.tf-sub{font-size:8px;font-family:'Space Mono',monospace;margin-top:4px;}

.align-row{
  display:flex;align-items:center;gap:8px;
  padding:8px 11px;margin-bottom:10px;
  border:1px solid var(--border);background:var(--bg3);
}
.align-label{font-size:9px;font-family:'Space Mono',monospace;color:var(--text2);flex:1;}
.align-dots{display:flex;gap:4px;}
.align-dot{width:8px;height:8px;border-radius:50%;}
.align-result{font-size:10px;font-weight:700;font-family:'Space Mono',monospace;}

.score-block{text-align:center;padding:14px 0 8px;}
.score-num{font-size:60px;font-weight:800;line-height:1;font-family:'Space Mono',monospace;}
.score-label{font-size:9px;letter-spacing:.14em;color:var(--text2);margin-top:2px;}
.score-bar-wrap{margin:10px 0 3px;height:3px;background:var(--bg3);}
.score-bar{height:100%;transition:width .6s;}
.score-items{display:grid;grid-template-columns:1fr 1fr;gap:5px;margin-top:10px;}
.sc-item{
  padding:7px 9px;background:var(--bg3);border:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
}
.sc-item-label{font-size:8px;color:var(--text2);font-family:'Space Mono',monospace;}
.sc-item-sub{font-size:7px;color:var(--text3);font-family:'Space Mono',monospace;}
.sc-item-val{font-size:9px;font-family:'Space Mono',monospace;font-weight:700;}

/* gauges */
.gauge-row{display:flex;align-items:center;gap:8px;padding:7px 10px;background:var(--bg3);border:1px solid var(--border);margin-bottom:4px;}
.gauge-label{font-size:8px;color:var(--text2);font-family:'Space Mono',monospace;width:70px;flex-shrink:0;}
.gauge-track{flex:1;height:3px;background:var(--bg);border:1px solid var(--border);position:relative;}
.gauge-fill{height:100%;transition:width .5s;}
.gauge-val{font-size:9px;font-family:'Space Mono',monospace;font-weight:700;width:36px;text-align:right;flex-shrink:0;}

/* ‚îÄ‚îÄ CENTER PANEL: SIGNAL ‚îÄ‚îÄ */
.signal-hero{
  padding:18px 16px 14px;border-bottom:1px solid var(--border);
  position:relative;overflow:hidden;
}
.signal-hero.bull{background:linear-gradient(135deg,var(--green-dim) 0%,transparent 60%);}
.signal-hero.bear{background:linear-gradient(135deg,var(--red-dim) 0%,transparent 60%);}
.sh-top{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:10px;}
.sh-badge{font-size:11px;font-weight:800;font-family:'Space Mono',monospace;padding:4px 10px;border:1.5px solid;}
.sh-badge.bull{border-color:var(--green);color:var(--green);background:var(--green-dim);}
.sh-badge.bear{border-color:var(--red);color:var(--red);background:var(--red-dim);}
.sh-badge.neu{border-color:var(--text3);color:var(--text2);}
.sh-asset{font-size:22px;font-weight:800;letter-spacing:.04em;}
.sh-tf{font-family:'Space Mono',monospace;font-size:10px;color:var(--text2);margin-top:2px;}
.sh-tags{display:flex;gap:5px;flex-wrap:wrap;margin-top:8px;}
.tag{font-family:'Space Mono',monospace;font-size:8px;padding:2px 7px;border:1px solid;}
.tag-green{border-color:var(--green2);color:var(--green);background:rgba(0,229,160,.06);}
.tag-red{border-color:var(--red);color:var(--red);background:rgba(255,64,96,.06);}
.tag-yellow{border-color:var(--yellow);color:var(--yellow);background:rgba(245,200,66,.06);}
.tag-blue{border-color:var(--blue);color:var(--blue);background:rgba(58,158,248,.06);}
.tag-gray{border-color:var(--border2);color:var(--text3);}
.sh-price{font-family:'Space Mono',monospace;font-size:28px;font-weight:700;margin-top:6px;}
.sh-atr{font-size:9px;color:var(--text3);font-family:'Space Mono',monospace;margin-top:2px;}

/* levels table */
.levels-grid{display:grid;grid-template-columns:1fr 1fr 1fr 1fr 1fr 1fr;gap:6px;padding:12px 16px;border-bottom:1px solid var(--border);}
.lvl-cell{background:var(--bg3);border:1px solid var(--border);padding:8px 10px;text-align:center;}
.lvl-cell.entry-cell{border-color:var(--blue);background:var(--blue-dim);}
.lvl-cell.stop-cell{border-color:var(--red);background:var(--red-dim);}
.lvl-cell.tp-cell{border-color:rgba(0,229,160,.3);background:var(--green-dim);}
.lvl-label{font-size:7px;color:var(--text3);font-family:'Space Mono',monospace;letter-spacing:.1em;margin-bottom:4px;}
.lvl-val{font-size:12px;font-weight:700;font-family:'Space Mono',monospace;}
.lvl-rr{font-size:8px;color:var(--text2);font-family:'Space Mono',monospace;}

/* analysis block */
.analysis-block{padding:14px 16px;border-bottom:1px solid var(--border);}
.ab-title{font-size:9px;font-weight:700;letter-spacing:.1em;color:var(--text3);font-family:'Space Mono',monospace;margin-bottom:8px;text-transform:uppercase;}
.ab-text{font-size:11px;line-height:1.65;color:var(--text);}
.ab-list{display:flex;flex-direction:column;gap:3px;}
.ab-list-item{font-size:10px;color:var(--text2);display:flex;gap:6px;line-height:1.5;}
.ab-list-item .ab-arrow{flex-shrink:0;}

/* telegram block */
.tg-block{background:var(--bg3);border:1px solid var(--border);padding:12px;margin:14px 16px 0;}
.tg-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;}
.tg-hdr-label{font-size:8px;font-family:'Space Mono',monospace;color:var(--text3);letter-spacing:.1em;text-transform:uppercase;}
.tg-copy-btn{font-family:'Space Mono',monospace;font-size:8px;padding:3px 8px;border:1px solid var(--border2);background:transparent;color:var(--text2);cursor:pointer;transition:all .18s;}
.tg-copy-btn:hover{border-color:var(--green);color:var(--green);}
.tg-content{font-family:'Space Mono',monospace;font-size:10px;line-height:1.7;color:var(--text2);white-space:pre-wrap;}

/* analyze btn */
.analyze-btn{
  width:100%;padding:14px;margin:12px 0 0;
  font-family:'Space Mono',monospace;font-size:11px;letter-spacing:.1em;font-weight:700;
  border:1.5px solid var(--green);background:var(--green-dim);color:var(--green);
  cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:8px;
}
.analyze-btn:hover{background:rgba(0,229,160,.15);box-shadow:0 0 20px rgba(0,229,160,.15);}
.analyze-btn.loading{border-color:var(--yellow);color:var(--yellow);background:rgba(245,200,66,.06);}
.analyze-btn.blocked{border-color:var(--border2);color:var(--text3);background:transparent;cursor:not-allowed;}

/* ‚îÄ‚îÄ RIGHT PANEL: INDICATORS ‚îÄ‚îÄ */
.ind-card{
  background:var(--bg3);border:1px solid var(--border);
  padding:10px 12px;margin-bottom:6px;display:flex;align-items:center;gap:10px;
}
.ind-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0;}
.ind-name{font-size:9px;font-weight:700;letter-spacing:.07em;font-family:'Space Mono',monospace;color:var(--text2);}
.ind-status{font-size:10px;font-family:'Space Mono',monospace;font-weight:700;}
.ind-metric{font-size:8px;color:var(--text3);font-family:'Space Mono',monospace;margin-top:1px;}
.ind-tfs{display:flex;gap:3px;margin-top:4px;}
.ind-tf-badge{font-size:7px;padding:1px 4px;border:1px solid var(--border);color:var(--text3);font-family:'Space Mono',monospace;}
.ind-tf-badge.active-tf{border-color:var(--blue);color:var(--blue);}
.ind-tf-badge.bull-tf{border-color:var(--green);color:var(--green);}
.ind-tf-badge.bear-tf{border-color:var(--red);color:var(--red);}
.ind-right{flex:1;}

/* ‚îÄ‚îÄ BOTTOM PANELS ‚îÄ‚îÄ */
.bottom-grid{display:grid;grid-template-columns:1fr 2fr;gap:12px;padding-bottom:20px;}
.history-item{
  display:flex;align-items:center;gap:10px;
  padding:9px 12px;border-bottom:1px solid var(--border);
  cursor:pointer;transition:background .15s;
}
.history-item:hover{background:var(--bg3);}
.hi-dir{font-size:9px;font-weight:700;font-family:'Space Mono',monospace;padding:3px 7px;flex-shrink:0;}
.hi-asset{font-size:11px;font-weight:700;}
.hi-tf{font-size:8px;color:var(--text3);font-family:'Space Mono',monospace;margin-top:1px;}
.hi-result{font-size:9px;font-family:'Space Mono',monospace;margin-left:auto;text-align:right;}

/* alerts feed */
.alerts-feed{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:8px;}
.alert-card{
  border:1px solid var(--border);background:var(--bg3);padding:10px 12px;
  cursor:pointer;transition:all .18s;
}
.alert-card:hover{border-color:var(--border2);}
.alert-card.premium{border-left:2px solid var(--green);}
.alert-card.warning{border-left:2px solid var(--red);}
.alert-card.info{border-left:2px solid var(--blue);}
.ac-title{font-size:10px;font-weight:700;}
.ac-desc{font-size:9px;color:var(--text2);font-family:'Space Mono',monospace;margin-top:3px;}
.ac-time{font-size:8px;color:var(--text3);font-family:'Space Mono',monospace;margin-top:5px;}

/* ‚îÄ‚îÄ VIEW: MULTI ATIVOS ‚îÄ‚îÄ */
.multi-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(175px,1fr));gap:8px;padding:14px 0;}
.asset-card{
  border:1px solid var(--border);background:var(--bg2);padding:14px 12px;
  cursor:pointer;transition:all .18s;position:relative;
}
.asset-card:hover{border-color:var(--border2);}
.asset-card.bull{border-top:2px solid var(--green);}
.asset-card.bear{border-top:2px solid var(--red);}
.asset-card.selected{background:var(--bg3);}
.ac-score{position:absolute;top:10px;right:10px;font-family:'Space Mono',monospace;font-size:20px;font-weight:800;opacity:.3;}
.ac-name{font-size:14px;font-weight:700;margin-bottom:4px;}
.ac-dir{font-size:10px;font-family:'Space Mono',monospace;font-weight:700;}
.ac-meta{font-size:8px;color:var(--text3);font-family:'Space Mono',monospace;margin-top:6px;}

/* ‚îÄ‚îÄ VIEW: HIST√ìRICO ‚îÄ‚îÄ */
.hist-stats{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-bottom:14px;}
.hist-filters{display:flex;gap:8px;margin-bottom:10px;}
.hist-select{font-family:'Space Mono',monospace;font-size:9px;background:var(--bg3);border:1px solid var(--border);color:var(--text);padding:5px 8px;cursor:pointer;}
.hist-table{border:1px solid var(--border);}
.hist-row-hdr{display:grid;grid-template-columns:60px 100px 55px 100px 100px 100px 65px 1fr;gap:0;padding:7px 12px;background:var(--bg3);border-bottom:1px solid var(--border);font-size:8px;font-family:'Space Mono',monospace;color:var(--text3);letter-spacing:.08em;}
.hist-row{display:grid;grid-template-columns:60px 100px 55px 100px 100px 100px 65px 1fr;gap:0;padding:8px 12px;border-bottom:1px solid var(--border);cursor:pointer;transition:background .15s;font-size:10px;}
.hist-row:hover{background:var(--bg3);}

/* ‚îÄ‚îÄ VIEW: SETTINGS ‚îÄ‚îÄ */
.settings-section{margin-bottom:20px;}
.settings-title{font-size:10px;font-weight:700;letter-spacing:.1em;color:var(--text2);font-family:'Space Mono',monospace;margin-bottom:10px;padding-bottom:7px;border-bottom:1px solid var(--border);text-transform:uppercase;}
.asset-config-row{display:grid;align-items:center;gap:8px;padding:8px 12px;border-bottom:1px solid var(--border);background:var(--bg2);}
.cfg-input{font-family:'Space Mono',monospace;font-size:9px;background:var(--bg3);border:1px solid var(--border);color:var(--text);padding:4px 7px;width:100%;}
.cfg-select{font-family:'Space Mono',monospace;font-size:9px;background:var(--bg3);border:1px solid var(--border);color:var(--text);padding:4px 7px;width:100%;cursor:pointer;}
.toggle-wrap{display:flex;justify-content:center;}
.toggle{width:32px;height:17px;border-radius:9px;border:1px solid var(--border2);background:var(--bg3);position:relative;cursor:pointer;transition:all .2s;}
.toggle::after{content:'';position:absolute;top:2px;left:2px;width:11px;height:11px;border-radius:50%;background:var(--text3);transition:all .2s;}
.toggle.on{border-color:var(--green);background:rgba(0,229,160,.15);}
.toggle.on::after{left:17px;background:var(--green);}
.global-row{display:flex;align-items:center;justify-content:space-between;padding:9px 12px;border-bottom:1px solid var(--border);}
.global-label{font-size:9px;font-family:'Space Mono',monospace;color:var(--text2);}
.global-ctrl{display:flex;align-items:center;gap:6px;}
.add-asset-row{display:none;align-items:center;gap:8px;padding:8px 12px;background:var(--bg3);border-top:1px solid var(--border);}

/* ‚îÄ‚îÄ WEBHOOK GUIDE ‚îÄ‚îÄ */
.webhook-box{background:var(--bg3);border:1px solid var(--border);padding:16px;margin-bottom:12px;}
.wb-title{font-size:10px;font-weight:700;font-family:'Space Mono',monospace;color:var(--text2);margin-bottom:10px;text-transform:uppercase;letter-spacing:.1em;}
.wb-url{font-family:'Space Mono',monospace;font-size:10px;color:var(--green);background:var(--bg4);padding:8px 12px;border:1px solid var(--border);word-break:break-all;display:flex;align-items:center;justify-content:space-between;gap:8px;}
.wb-copy{font-family:'Space Mono',monospace;font-size:8px;padding:3px 7px;border:1px solid var(--border2);background:transparent;color:var(--text2);cursor:pointer;flex-shrink:0;}
.wb-copy:hover{border-color:var(--green);color:var(--green);}
.wb-step{display:flex;gap:10px;padding:8px 0;border-bottom:1px solid var(--border);}
.wb-step-num{width:20px;height:20px;border:1px solid var(--border2);display:flex;align-items:center;justify-content:center;font-family:'Space Mono',monospace;font-size:9px;color:var(--text3);flex-shrink:0;}
.wb-step-text{font-size:11px;line-height:1.6;color:var(--text2);}
.wb-step-text strong{color:var(--text);}

/* ‚îÄ‚îÄ API KEY GUIDE ‚îÄ‚îÄ */
.api-guide{background:var(--bg3);border:1px solid var(--yellow);padding:16px;margin-bottom:12px;}
.ag-title{font-size:10px;font-weight:700;font-family:'Space Mono',monospace;color:var(--yellow);margin-bottom:10px;text-transform:uppercase;letter-spacing:.1em;}
.ag-step{display:flex;gap:10px;padding:8px 0;border-bottom:1px solid var(--border);}
.ag-num{width:22px;height:22px;border:1px solid var(--yellow);display:flex;align-items:center;justify-content:center;font-family:'Space Mono',monospace;font-size:9px;color:var(--yellow);flex-shrink:0;}
.ag-text{font-size:11px;line-height:1.6;color:var(--text2);}
.ag-text a{color:var(--green);text-decoration:none;}
.ag-text a:hover{text-decoration:underline;}
.ag-text strong{color:var(--text);}

/* utils */
.mono{font-family:'Space Mono',monospace;}
.fw700{font-weight:700;}
.fs9{font-size:9px;}
.fs10{font-size:10px;}
.fs11{font-size:11px;}
.c-green{color:var(--green);}
.c-red{color:var(--red);}
.c-yellow{color:var(--yellow);}
.c-blue{color:var(--blue);}
.c-gray{color:var(--text3);}
.c-text2{color:var(--text2);}
.mt4{margin-top:4px;}
.mt8{margin-top:8px;}
.mt12{margin-top:12px;}
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<header>
<div class="container z1">
<div class="header-inner">
  <a class="logo" href="#">
    <div class="logo-box">AP</div>
    <span class="logo-name"><span>APEX</span> HUB</span>
    <span class="logo-ver">v3.0</span>
  </a>
  <div class="header-sep"></div>
  <div class="live-pill"><div class="live-dot"></div>LIVE</div>
  <div class="header-sep"></div>
  <span id="clock" class="mono fs9"></span>
  <div class="header-sep"></div>
  <div class="conn-pill"><div id="connDot"></div><span id="connLabel">CONECTANDO...</span></div>
  <div class="header-sep"></div>
  <span id="globalStats" class="mono fs9 c-gray">carregando...</span>
  <div class="header-right">
    <button class="nav-btn active" id="btnDash" onclick="showView('dashboard',this)">DASHBOARD</button>
    <button class="nav-btn" id="btnAtivos" onclick="showView('ativos',this)">MULTI-ATIVOS</button>
    <button class="nav-btn" id="btnHist" onclick="showView('history',this)">HIST√ìRICO</button>
    <button class="nav-btn" id="btnTg" onclick="showView('telegram',this)">TELEGRAM</button>
    <button class="nav-btn" id="btnCfg" onclick="showView('settings',this)">CONFIG</button>
    <button class="nav-btn" id="btnGuide" onclick="showView('guide',this)">GUIA</button>
  </div>
</div>
</div>
</header>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ASSET BAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="asset-bar-wrap z1">
<div class="container">
<div class="asset-bar" id="assetBar"></div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     VIEW: DASHBOARD
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="view active z1" id="view-dashboard">
<div class="container">
<div class="dash-grid">

  <!-- LEFT -->
  <div>
    <!-- TF Alignment -->
    <div class="panel">
      <div class="panel-hdr">
        <div class="ph-title"><div class="ph-dot" style="background:var(--blue)"></div>TF ALIGNMENT</div>
        <span class="mono fs9 c-gray" id="indTFLabel">‚Äî</span>
      </div>
      <div class="panel-body">
        <div class="tf-grid" id="tfAlignment"></div>
        <div class="align-row">
          <span class="align-label">SINCRONIZA√á√ÉO</span>
          <div class="align-dots" id="alignDots"></div>
          <span class="align-result" id="alignResult">‚Äî</span>
        </div>
        <div style="text-align:center;margin-top:4px;">
          <span class="tag tag-gray" id="alignTag">AGUARDANDO</span>
        </div>
      </div>
    </div>

    <!-- Score -->
    <div class="panel mt8">
      <div class="panel-hdr"><div class="ph-title"><div class="ph-dot" style="background:var(--green)"></div>CONFLU√äNCIA</div></div>
      <div class="panel-body">
        <div class="score-block">
          <div class="score-num" id="scoreNumber">‚Äî</div>
          <div class="score-label" id="scoreLabel">/ 5</div>
          <div class="score-bar-wrap"><div class="score-bar" id="scoreBarFill" style="width:0"></div></div>
        </div>
        <div class="score-items" id="scoreItems"></div>

        <div class="mt12">
          <div class="gauge-row">
            <span class="gauge-label">PROB. IA</span>
            <div class="gauge-track"><div class="gauge-fill" id="probFill" style="width:0"></div></div>
            <span class="gauge-val" id="probValue">‚Äî</span>
          </div>
          <div class="gauge-row">
            <span class="gauge-label">ER KAUFMAN</span>
            <div class="gauge-track"><div class="gauge-fill" id="erFill" style="width:0"></div></div>
            <span class="gauge-val" id="erValue">‚Äî</span>
          </div>
          <div class="gauge-row">
            <span class="gauge-label">ADX</span>
            <div class="gauge-track"><div class="gauge-fill" id="adxFill" style="width:0"></div></div>
            <span class="gauge-val" id="adxValue">‚Äî</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- CENTER -->
  <div class="panel">
    <div class="panel-hdr">
      <div class="ph-title">
        <div class="ph-dot" id="signalDotColor" style="background:var(--text3)"></div>
        <span id="signalPanelTitle">AN√ÅLISE ATIVA ‚Äî AGUARDANDO</span>
      </div>
      <div style="display:flex;align-items:center;gap:6px;">
        <span class="mono fs9 c-gray" id="signalScoreInline">‚Äî</span>
        <button class="nav-btn" onclick="manualRefresh()">‚Ü∫ REFRESH</button>
      </div>
    </div>

    <!-- Hero -->
    <div class="signal-hero" id="signalHero">
      <div class="sh-top">
        <div>
          <div class="sh-badge neu" id="signalBadge">‚Äì NEUTRO</div>
          <div class="sh-asset mt4" id="signalAsset">Selecione um ativo</div>
          <div class="sh-tf mono" id="signalTFTag">‚Äî</div>
        </div>
        <div style="text-align:right">
          <div class="sh-price" id="currentPrice">‚Äî</div>
          <div class="sh-atr" id="atrLabel">ATR: ‚Äî</div>
        </div>
      </div>
      <div class="sh-tags">
        <span class="tag tag-gray" id="probTag" style="display:none">PROB ‚Äî</span>
        <span class="tag tag-green" id="pathTag" style="display:none">‚≠ê CAMINHO LIVRE</span>
        <span class="tag tag-yellow" id="weekendBadge" style="display:none">‚ö† WEEKEND</span>
      </div>
    </div>

    <!-- N√≠veis -->
    <div class="levels-grid">
      <div class="lvl-cell entry-cell"><div class="lvl-label">ENTRADA</div><div class="lvl-val c-blue" id="levelEntry">‚Äî</div></div>
      <div class="lvl-cell stop-cell"><div class="lvl-label">STOP</div><div class="lvl-val c-red" id="levelStop">‚Äî</div></div>
      <div class="lvl-cell tp-cell"><div class="lvl-label">TP1</div><div class="lvl-val c-green" id="levelTP1">‚Äî</div></div>
      <div class="lvl-cell tp-cell"><div class="lvl-label">TP2</div><div class="lvl-val c-green" id="levelTP2">‚Äî</div></div>
      <div class="lvl-cell tp-cell"><div class="lvl-label">TP3</div><div class="lvl-val c-green" id="levelTP3">‚Äî</div></div>
      <div class="lvl-cell"><div class="lvl-label">R/R</div><div class="lvl-rr c-yellow" id="levelRR">‚Äî</div><div class="lvl-label mt4" id="levelBias">‚Äî</div></div>
    </div>

    <!-- An√°lise Claude -->
    <div class="analysis-block">
      <div class="ab-title">ESTRUTURA SMC & LIQUIDEZ</div>
      <div class="ab-text" id="analysisEstrutura">Aguardando sinal do TradingView...</div>
    </div>
    <div class="analysis-block">
      <div class="ab-title">MICROESTRUTURA & FLUXO</div>
      <div class="ab-text" id="analysisMicro">‚Äî</div>
    </div>
    <div class="analysis-block">
      <div class="ab-title">GEST√ÉO DE RISCO</div>
      <div class="ab-text" id="analysisRisco">‚Äî</div>
    </div>
    <div class="analysis-block">
      <div class="ab-title">CONFLU√äNCIAS IDENTIFICADAS</div>
      <div class="ab-list" id="confluenceList"></div>
    </div>
    <div class="analysis-block" style="border-bottom:none">
      <div class="ab-title">ALERTAS & RISCOS</div>
      <div class="ab-list" id="alertsList"></div>
    </div>

    <!-- Telegram snippet -->
    <div class="tg-block">
      <div class="tg-hdr">
        <span class="tg-hdr-label">‚úà RESUMO TELEGRAM</span>
        <button class="tg-copy-btn" onclick="copyTG()">COPIAR</button>
      </div>
      <div class="tg-content" id="tgContent">Aguardando an√°lise Claude...</div>
    </div>

    <div style="padding:0 16px 14px;">
      <button class="analyze-btn blocked" id="analyzeBtn" onclick="triggerAnalysis()">
        <span>‚è≥ AGUARDANDO SINAL</span>
      </button>
    </div>
  </div>

  <!-- RIGHT: INDICADORES -->
  <div>
    <div class="panel">
      <div class="panel-hdr"><div class="ph-title"><div class="ph-dot" style="background:var(--purple)"></div>INDICADORES</div></div>
      <div class="panel-body">
        <div class="ind-card">
          <div class="ind-dot" style="background:var(--blue)"></div>
          <div class="ind-right">
            <div class="ind-name">SD ZONES</div>
            <div class="ind-status" id="indStatus1">‚Äì INATIVO</div>
            <div class="ind-metric" id="indMetric1">‚Äî</div>
            <div class="ind-tfs" id="ind1"></div>
          </div>
        </div>
        <div class="ind-card">
          <div class="ind-dot" style="background:var(--green)"></div>
          <div class="ind-right">
            <div class="ind-name">RAH KEO v7</div>
            <div class="ind-status" id="indStatus2">‚Äì INATIVO</div>
            <div class="ind-metric" id="indMetric2">‚Äî</div>
            <div class="ind-tfs" id="ind2"></div>
          </div>
        </div>
        <div class="ind-card">
          <div class="ind-dot" style="background:var(--yellow)"></div>
          <div class="ind-right">
            <div class="ind-name">MM V4 KERNEL</div>
            <div class="ind-status" id="indStatus3">‚Äì INATIVO</div>
            <div class="ind-metric" id="indMetric3">‚Äî</div>
            <div class="ind-tfs" id="ind3"></div>
          </div>
        </div>
        <div class="ind-card">
          <div class="ind-dot" style="background:var(--orange)"></div>
          <div class="ind-right">
            <div class="ind-name">OSC MATRIX</div>
            <div class="ind-status" id="indStatus4">‚Äì INATIVO</div>
            <div class="ind-metric" id="indMetric4">‚Äî</div>
            <div class="ind-tfs" id="ind4"></div>
          </div>
        </div>
        <div class="ind-card">
          <div class="ind-dot" style="background:var(--purple)"></div>
          <div class="ind-right">
            <div class="ind-name">STOCH RSI</div>
            <div class="ind-status" id="indStatus5">‚Äì INATIVO</div>
            <div class="ind-metric" id="indMetric5">‚Äî</div>
            <div class="ind-tfs" id="ind5"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Recentes -->
    <div class="panel mt8">
      <div class="panel-hdr"><div class="ph-title"><div class="ph-dot" style="background:var(--yellow)"></div>SINAIS RECENTES</div></div>
      <div id="recentSignals" style="color:var(--text3);font-size:10px;text-align:center;padding:16px;">Aguardando sinais...</div>
    </div>
  </div>

</div><!-- end dash-grid -->

<!-- ALERTS FEED -->
<div class="panel" style="margin-bottom:12px;">
  <div class="panel-hdr">
    <div class="ph-title"><div class="ph-dot" style="background:var(--red)"></div>FEED DE ALERTAS</div>
    <span class="mono fs9 c-gray" id="alertCount">‚Äî</span>
  </div>
  <div class="panel-body">
    <div class="alerts-feed" id="alertsFeed">
      <div style="grid-column:1/-1;padding:16px;text-align:center;font-size:10px;color:var(--text3);">Aguardando sinais do TradingView...</div>
    </div>
  </div>
</div>

</div><!-- end container -->
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê VIEW: MULTI-ATIVOS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="view z1" id="view-ativos">
<div class="container">
  <div class="panel" style="margin:12px 0;">
    <div class="panel-hdr"><div class="ph-title"><div class="ph-dot" style="background:var(--blue)"></div>TODOS OS ATIVOS MONITORADOS</div></div>
    <div class="panel-body">
      <div class="multi-grid" id="multiAssetGrid"></div>
    </div>
  </div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê VIEW: HIST√ìRICO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="view z1" id="view-history">
<div class="container" style="padding-top:12px;">
  <div class="hist-stats" id="histStats"></div>
  <div class="hist-filters">
    <select class="hist-select" id="histFilterDir" onchange="renderHistory()">
      <option value="">Todas dire√ß√µes</option>
      <option value="buy">BUY</option>
      <option value="sell">SELL</option>
    </select>
    <select class="hist-select" id="histFilterAsset" onchange="renderHistory()">
      <option value="">Todos ativos</option>
    </select>
  </div>
  <div class="panel">
    <div class="hist-table">
      <div class="hist-row-hdr"><span>DIR</span><span>ATIVO</span><span>SCORE</span><span>ENTRADA</span><span>STOP</span><span>TP1</span><span>PROB</span><span>DATA</span></div>
      <div id="historyTableBody"></div>
    </div>
  </div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê VIEW: TELEGRAM ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="view z1" id="view-telegram">
<div class="container" style="padding-top:12px;">
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
    <div class="panel">
      <div class="panel-hdr"><div class="ph-title"><div class="ph-dot" style="background:var(--blue)"></div>√öLTIMO RESUMO</div></div>
      <div class="panel-body">
        <div class="tg-block" style="margin:0">
          <div class="tg-hdr">
            <span class="tg-hdr-label">‚úà MENSAGEM PARA CANAL</span>
            <button class="tg-copy-btn" onclick="copyTGView()">COPIAR</button>
          </div>
          <div class="tg-content" id="tgViewContent" style="color:var(--text3);">Aguardando sinal com an√°lise Claude...</div>
        </div>
        <div class="mt12 mono fs9 c-gray" style="line-height:1.8">
          Gerado automaticamente pelo Claude APEX ap√≥s cada sinal.<br>
          Configure TELEGRAM_BOT_TOKEN e TELEGRAM_CHAT_ID no Railway.
        </div>
      </div>
    </div>
    <div class="panel">
      <div class="panel-hdr"><div class="ph-title"><div class="ph-dot" style="background:var(--yellow)"></div>HIST√ìRICO DE RESUMOS</div></div>
      <div id="tgHistory" style="color:var(--text3);font-size:10px;text-align:center;padding:18px;">Carregando...</div>
    </div>
  </div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê VIEW: SETTINGS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="view z1" id="view-settings">
<div class="container" style="padding-top:12px;">
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
    <div class="panel">
      <div class="panel-hdr">
        <div class="ph-title"><div class="ph-dot" style="background:var(--green)"></div>ATIVOS MONITORADOS</div>
        <button class="nav-btn" onclick="showAddRow()">+ ADICIONAR</button>
      </div>
      <div>
        <div class="asset-config-row" style="grid-template-columns:110px 60px 60px 60px 55px 40px 32px;background:var(--bg3);border-bottom:1px solid var(--border);">
          <span class="mono fs9 c-gray">ATIVO</span>
          <span class="mono fs9 c-gray">TF P</span>
          <span class="mono fs9 c-gray">TF C</span>
          <span class="mono fs9 c-gray">TF E</span>
          <span class="mono fs9 c-gray">SCORE</span>
          <span class="mono fs9 c-gray">ON</span>
          <span></span>
        </div>
        <div id="assetConfigRows"></div>
        <div class="add-asset-row" id="addRow">
          <input class="cfg-input" id="newAssetInput" placeholder="ex: SOL/USDT" style="width:130px">
          <select class="cfg-select" id="newClass" style="width:100px">
            <option>Crypto</option><option>Forex</option><option>√çndice</option><option>Commodity</option>
          </select>
          <button class="nav-btn" onclick="addAsset()">SALVAR</button>
          <button class="nav-btn" onclick="$('addRow').style.display='none'">‚úï</button>
        </div>
      </div>
    </div>
    <div>
      <div class="panel" style="margin-bottom:12px;">
        <div class="panel-hdr"><div class="ph-title"><div class="ph-dot" style="background:var(--yellow)"></div>PRESETS POR CLASSE</div></div>
        <div id="presetRows"></div>
      </div>
      <div class="panel">
        <div class="panel-hdr"><div class="ph-title"><div class="ph-dot" style="background:var(--red)"></div>A√á√ïES</div></div>
        <div class="panel-body">
          <button class="analyze-btn" style="margin:0" onclick="resetConfig()">‚Ü∫ RESETAR CONFIGURA√á√ïES</button>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê VIEW: GUIA ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="view z1" id="view-guide">
<div class="container" style="padding-top:12px;padding-bottom:30px;">
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">

    <!-- API KEY -->
    <div class="api-guide">
      <div class="ag-title">üîë PASSO 1 ‚Äî CRIAR API KEY ANTHROPIC</div>
      <div class="ag-step">
        <div class="ag-num">1</div>
        <div class="ag-text">Acesse <a href="https://console.anthropic.com" target="_blank">console.anthropic.com</a> e crie sua conta (gratuito com cr√©ditos iniciais).</div>
      </div>
      <div class="ag-step">
        <div class="ag-num">2</div>
        <div class="ag-text">No menu lateral, clique em <strong>"API Keys"</strong> ‚Üí <strong>"Create Key"</strong>. D√™ um nome como "apex-hub".</div>
      </div>
      <div class="ag-step">
        <div class="ag-num">3</div>
        <div class="ag-text">Copie a chave gerada (come√ßa com <strong>sk-ant-...</strong>). Guarde bem ‚Äî n√£o aparece novamente.</div>
      </div>
      <div class="ag-step">
        <div class="ag-num">4</div>
        <div class="ag-text">No Railway, abra seu projeto ‚Üí <strong>"Variables"</strong> ‚Üí adicione: <strong>ANTHROPIC_API_KEY</strong> = sua chave.</div>
      </div>
      <div class="ag-step" style="border:none">
        <div class="ag-num">5</div>
        <div class="ag-text">Adicione tamb√©m: <strong>SCORE_MINIMO</strong> = 3 e <strong>REQUIRE_TF_ALIGNMENT</strong> = false</div>
      </div>
    </div>

    <!-- WEBHOOK -->
    <div class="webhook-box">
      <div class="wb-title">üîó PASSO 2 ‚Äî CONFIGURAR WEBHOOK NO TRADINGVIEW</div>
      <div class="wb-step">
        <div class="wb-step-num">1</div>
        <div class="wb-step-text">Adicione o indicador <strong>APEX HUB Aggregator v1.0</strong> ao seu gr√°fico no TradingView.</div>
      </div>
      <div class="wb-step">
        <div class="wb-step-num">2</div>
        <div class="wb-step-text">Clique em <strong>"Alertas"</strong> ‚Üí Condi√ß√£o: <strong>APEX ‚Äî Webhook Principal</strong>. Frequ√™ncia: <strong>Uma vez por barra</strong>.</div>
      </div>
      <div class="wb-step">
        <div class="wb-step-num">3</div>
        <div class="wb-step-text">Em <strong>"Notifica√ß√µes"</strong>, ative <strong>Webhook URL</strong> e cole o endere√ßo abaixo:</div>
      </div>
      <div class="wb-url">
        <span id="webhookUrlDisplay">https://web-production-947e32.up.railway.app/webhook</span>
        <button class="wb-copy" onclick="copyWebhookUrl()">COPIAR</button>
      </div>
      <div class="wb-step" style="border:none;margin-top:8px">
        <div class="wb-step-num">4</div>
        <div class="wb-step-text">Em <strong>"Mensagem"</strong>, cole o JSON gerado pelo indicador (campo <strong>json_payload</strong> no Pine Script).</div>
      </div>
    </div>

    <!-- INDICADORES -->
    <div class="webhook-box" style="grid-column:1/-1">
      <div class="wb-title">üìä INDICADORES NECESS√ÅRIOS NO GR√ÅFICO</div>
      <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-top:8px;">
        <div style="background:var(--bg4);border:1px solid var(--border);padding:10px;">
          <div class="mono fs9 c-green fw700">RAH KEO Œ£ v7.0</div>
          <div class="mono fs9 c-gray mt4">Motor de sinais principal. EMA 8/24, Fibonacci din√¢mico, Order Blocks, Atratores.</div>
        </div>
        <div style="background:var(--bg4);border:1px solid var(--border);padding:10px;">
          <div class="mono fs9 c-blue fw700">MTF SD Zones</div>
          <div class="mono fs9 c-gray mt4">Zonas de Supply & Demand multi-timeframe. Detecta Order Blocks institucionais.</div>
        </div>
        <div style="background:var(--bg4);border:1px solid var(--border);padding:10px;">
          <div class="mono fs9 c-yellow fw700">MM V4 Kernel</div>
          <div class="mono fs9 c-gray mt4">ADX + Kernel Regression Lorentziano. For√ßa e dire√ß√£o da tend√™ncia.</div>
        </div>
        <div style="background:var(--bg4);border:1px solid var(--border);padding:10px;">
          <div class="mono fs9 c-orange fw700" style="--orange:#ff8c42">Oscillator Matrix</div>
          <div class="mono fs9 c-gray mt4">Money Flow + Hyper Wave. Conflu√™ncia de momentum e volume.</div>
        </div>
        <div style="background:var(--bg4);border:1px solid var(--border);padding:10px;">
          <div class="mono fs9 fw700" style="color:var(--purple)">Stoch RSI</div>
          <div class="mono fs9 c-gray mt4">Stochastic RSI. Identifica zonas de sobrecompra/sobrevenda para timing.</div>
        </div>
      </div>
    </div>

    <!-- AGGREGATOR -->
    <div class="webhook-box" style="grid-column:1/-1">
      <div class="wb-title">‚öô AGGREGATOR v1.0 ‚Äî CONFIGURA√á√ÉO DO PINE SCRIPT</div>
      <div style="font-size:11px;line-height:1.7;color:var(--text2);">
        O <strong style="color:var(--text)">APEX HUB Aggregator v1.0</strong> √© o indicador Pine Script que consolida os dados dos 5 indicadores em um √∫nico JSON e dispara o webhook.<br><br>
        Configura√ß√µes importantes no indicador:
        <ul style="margin-top:8px;padding-left:16px;display:flex;flex-direction:column;gap:4px;">
          <li><strong style="color:var(--text)">Nome do ativo:</strong> Use exatamente o mesmo nome que cadastrou aqui no hub (ex: BTC/USDT)</li>
          <li><strong style="color:var(--text)">Score m√≠nimo:</strong> 3 recomendado (filtra ru√≠do)</li>
          <li><strong style="color:var(--text)">TF Principal/Confirma√ß√£o/Entrada:</strong> Devem bater com os configurados no hub</li>
          <li><strong style="color:var(--text)">Ativar alertas webhook:</strong> Deve estar marcado como true</li>
        </ul>
      </div>
    </div>

  </div>
</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     JAVASCRIPT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONFIG
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const API_URL = 'https://web-production-947e32.up.railway.app';
const POLL_MS  = 15000;
const TF_OPT   = ['1m','3m','5m','15m','30m','1H','2H','4H','6H','12H','1D','1W'];
const CLASSES  = ['Crypto','Forex','√çndice','Commodity'];

// state
let lastSignals  = [];
let activeSignal = null;
let activeId     = 1;
let pollTimer    = null;

// assets
let assets = [
  {id:1,  name:'BTC/USDT', cls:'Crypto',    tf_p:'4H', tf_c:'1H',  tf_e:'15m', score:3, on:true,  bias:'neutral'},
  {id:2,  name:'ETH/USDT', cls:'Crypto',    tf_p:'4H', tf_c:'1H',  tf_e:'15m', score:3, on:true,  bias:'neutral'},
  {id:3,  name:'EUR/USD',  cls:'Forex',     tf_p:'4H', tf_c:'1H',  tf_e:'15m', score:3, on:true,  bias:'neutral'},
  {id:4,  name:'GBP/USD',  cls:'Forex',     tf_p:'4H', tf_c:'1H',  tf_e:'15m', score:3, on:true,  bias:'neutral'},
  {id:5,  name:'USD/JPY',  cls:'Forex',     tf_p:'4H', tf_c:'1H',  tf_e:'15m', score:3, on:true,  bias:'neutral'},
  {id:6,  name:'XAU/USD',  cls:'Commodity', tf_p:'4H', tf_c:'1H',  tf_e:'15m', score:3, on:true,  bias:'neutral'},
  {id:7,  name:'SP500',    cls:'√çndice',    tf_p:'1H', tf_c:'15m', tf_e:'5m',  score:3, on:true,  bias:'neutral'},
  {id:8,  name:'NQ100',    cls:'√çndice',    tf_p:'1H', tf_c:'15m', tf_e:'5m',  score:3, on:true,  bias:'neutral'},
  {id:9,  name:'AUD/USD',  cls:'Forex',     tf_p:'4H', tf_c:'1H',  tf_e:'15m', score:3, on:false, bias:'neutral'},
  {id:10, name:'USD/CAD',  cls:'Forex',     tf_p:'4H', tf_c:'1H',  tf_e:'15m', score:3, on:false, bias:'neutral'},
];

let presets = {
  'Crypto':    {tf_p:'4H', tf_c:'1H',  tf_e:'15m'},
  'Forex':     {tf_p:'4H', tf_c:'1H',  tf_e:'15m'},
  '√çndice':    {tf_p:'1H', tf_c:'15m', tf_e:'5m'},
  'Commodity': {tf_p:'4H', tf_c:'1H',  tf_e:'15m'},
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const $  = id => document.getElementById(id);
const setText = (id, v) => { const e = $(id); if (e) e.textContent = v ?? '‚Äî'; };
const f2 = v  => v != null && !isNaN(+v) ? (+v).toLocaleString('pt-BR',{minimumFractionDigits:2,maximumFractionDigits:2}) : '‚Äî';

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CLOCK
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function tick() {
  const n = new Date();
  const M = ['JAN','FEV','MAR','ABR','MAI','JUN','JUL','AGO','SET','OUT','NOV','DEZ'];
  setText('clock',`${String(n.getUTCDate()).padStart(2,'0')} ${M[n.getUTCMonth()]} ${n.getUTCFullYear()} ‚Äî ${String(n.getUTCHours()).padStart(2,'0')}:${String(n.getUTCMinutes()).padStart(2,'0')} UTC`);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONNECTION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setConn(status) {
  const dot = $('connDot'), label = $('connLabel');
  if (!dot) return;
  const m = {
    connecting: ['var(--yellow)', 'CONECTANDO...'],
    online:     ['var(--green)',  'BACKEND ONLINE'],
    offline:    ['var(--red)',    'BACKEND OFFLINE'],
  };
  const [bg, text] = m[status] || m.connecting;
  dot.style.background = bg;
  label.textContent = text;
  label.style.color = bg;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// API CALLS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function fetchSignals() {
  try {
    const r = await fetch(`${API_URL}/signals?limit=100`, {signal: AbortSignal.timeout(8000)});
    if (!r.ok) throw new Error(r.status);
    const d = await r.json();
    setConn('online');
    return d.signals || [];
  } catch {
    setConn('offline');
    return null;
  }
}

async function fetchStats() {
  try {
    const r = await fetch(`${API_URL}/api/stats`, {signal: AbortSignal.timeout(6000)});
    if (!r.ok) return;
    const d = await r.json();
    setText('globalStats', `${d.total} sinais ¬∑ ${d.assets?.length || 0} ativos ¬∑ Prob m√©dia ${d.avg_prob}%`);
  } catch {}
}

async function pollBackend() {
  const signals = await fetchSignals();
  if (signals) applySignals(signals);
  pollTimer = setTimeout(pollBackend, POLL_MS);
}

function manualRefresh() {
  setConn('connecting');
  clearTimeout(pollTimer);
  pollBackend();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// APPLY SIGNALS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function applySignals(signals) {
  lastSignals = signals;
  const byAsset = {};
  signals.forEach(s => { if (!byAsset[s.asset]) byAsset[s.asset] = s; });

  assets.forEach(a => {
    const s = byAsset[a.name];
    if (s) {
      a.bias = s.direction==='buy' ? 'bull' : s.direction==='sell' ? 'bear' : 'neutral';
      a.latestSignal = s;
    }
  });

  renderAssetBar();

  const active = assets.find(x => x.id === activeId);
  if (active?.latestSignal) renderSignal(active.latestSignal);

  renderRecentSignals(signals.slice(0, 8));
  renderAlertsFeed(signals.slice(0, 8));
  renderMultiAssets();

  const sel = $('histFilterAsset');
  if (sel) {
    const unique = [...new Set(signals.map(s => s.asset))];
    const cur = sel.value;
    sel.innerHTML = '<option value="">Todos ativos</option>' + unique.map(a => `<option value="${a}"${a===cur?' selected':''}>${a}</option>`).join('');
  }

  const cnt = $('alertCount');
  if (cnt && signals.length) { cnt.style.display='inline-block'; cnt.textContent=`${signals.length} sinais`; }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ASSET BAR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderAssetBar() {
  const bar = $('assetBar');
  if (!bar) return;
  bar.innerHTML = assets.filter(a => a.on).map(a => {
    const bc = a.bias==='bull'?'ab-bull':a.bias==='bear'?'ab-bear':'ab-neu';
    const bt = a.bias==='bull'?'BUY':a.bias==='bear'?'SELL':'‚Äì';
    const ac = a.id===activeId ? (a.bias==='bear'?'active bear':'active') : '';
    return `<div class="a-pill ${ac}" onclick="selectAsset(${a.id})">
      ${a.name}<span class="a-badge ${bc}">${bt}</span><span class="a-tf">${a.tf_p}</span>
    </div>`;
  }).join('');
}

function selectAsset(id) {
  activeId = id;
  renderAssetBar();
  const a = assets.find(x => x.id === id);
  if (a?.latestSignal) renderSignal(a.latestSignal);
  else clearDashboard(a);
  showView('dashboard', $('btnDash'));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER SIGNAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderSignal(sig) {
  if (!sig) return;
  activeSignal = sig;

  let payload = {}, analysis = {};
  try { payload  = JSON.parse(sig.payload  || '{}'); } catch {}
  try { analysis = JSON.parse(sig.analysis || '{}'); } catch {}

  const dir  = sig.direction || 'neutral';
  const bull = dir === 'buy', bear = dir === 'sell';
  const dirLabel = bull ? '‚ñ≤ LONG' : bear ? '‚ñº SHORT' : '‚Äì NEUTRO';
  const scoreColor = sig.score >= 4 ? 'var(--green)' : sig.score === 3 ? 'var(--yellow)' : 'var(--red)';

  const tfs  = payload.timeframes  || {};
  const lvl  = payload.levels      || {};
  const scr  = payload.score       || {};
  const sd   = payload.sd_zones    || {};
  const keo  = payload.keo         || {};
  const mm   = payload.mm_kernel   || {};
  const osc  = payload.osc_matrix  || {};
  const st   = payload.stoch_rsi   || {};
  const pr   = payload.price       || {};
  const psig = payload.signal      || {};
  const prob = analysis.probabilidade || sig.prob || 0;
  const isWk = payload.is_weekend  || sig.is_weekend || false;
  const pathClear = psig.path_clear || false;

  // header
  setText('signalPanelTitle', `AN√ÅLISE ATIVA ‚Äî ${sig.asset}`);
  setText('signalTFTag', `${tfs.principal||'4H'} ¬∑ ${(psig.type||'').toUpperCase()||dir.toUpperCase()}`);
  setText('signalScoreInline', `${sig.score||'‚Äî'}/5`);

  // hero
  const hero = $('signalHero');
  if (hero) hero.className = `signal-hero ${bull?'bull':bear?'bear':''}`;
  const badge = $('signalBadge');
  if (badge) { badge.className = `sh-badge ${bull?'bull':bear?'bear':'neu'}`; badge.textContent = dirLabel; }
  setText('signalAsset', `${sig.asset}${pathClear?' ‚≠ê':''}${isWk?' ‚ö† Weekend':''}`);
  setText('currentPrice', f2(pr.close));
  setText('atrLabel', `ATR: ${f2(pr.atr14)}`);

  // tags
  const probTag = $('probTag');
  if (probTag) {
    probTag.style.display = prob ? 'inline-block' : 'none';
    probTag.textContent = `PROB ${prob}%`;
    probTag.className = `tag ${prob>=70?'tag-green':prob>=50?'tag-yellow':'tag-red'}`;
  }
  const pathTag = $('pathTag'); if (pathTag) pathTag.style.display = pathClear ? 'inline-block' : 'none';
  const wkBadge = $('weekendBadge'); if (wkBadge) wkBadge.style.display = isWk ? 'inline-block' : 'none';

  const dc = bull?'var(--green)':bear?'var(--red)':'var(--text3)';
  const sd2 = $('signalDotColor'); if (sd2) sd2.style.background = dc;

  // levels
  setText('levelEntry', f2(lvl.entry));
  setText('levelStop',  f2(lvl.stop));
  setText('levelTP1',   f2(lvl.tp1));
  setText('levelTP2',   f2(lvl.tp2));
  setText('levelTP3',   f2(lvl.tp3));
  const rr = analysis.tabela_alvos?.rr_ratio;
  setText('levelRR', rr ? (typeof rr==='number'?`1:${rr.toFixed(1)}`:rr) : '‚Äî');
  setText('levelBias', analysis.vies || (bull?'BULLISH':bear?'BEARISH':'NEUTRO'));

  // TF alignment
  const tfs_arr = [
    {role:'PRINCIPAL',   tf:tfs.principal||'4H',  cls:bear?'bear':bull?'bull':'neu'},
    {role:'CONFIRMA√á√ÉO', tf:tfs.confirmacao||'1H', cls:bear?'bear':bull?'bull':'neu'},
    {role:'ENTRADA',     tf:tfs.entrada||'15m',    cls:'neu'},
  ];
  const tfEl = $('tfAlignment');
  const tfc = c => c==='bear'?'var(--red)':c==='bull'?'var(--green)':'var(--text2)';
  if (tfEl) tfEl.innerHTML = tfs_arr.map(t => `
    <div class="tf-card ${t.cls}">
      <div class="tf-role">${t.role}</div>
      <div class="tf-val" style="color:${tfc(t.cls)}">${t.tf}</div>
      <div class="tf-sub" style="color:${tfc(t.cls)}">${t.cls==='bear'?'BEAR':t.cls==='bull'?'BULL':'NEUTRO'}</div>
    </div>`).join('');

  const aligned = tfs_arr[0].cls === tfs_arr[1].cls && tfs_arr[0].cls !== 'neu';
  const adEl = $('alignDots');
  if (adEl) adEl.innerHTML = tfs_arr.slice(0,2).map(t => `<div class="align-dot" style="background:${tfc(t.cls)}"></div>`).join('');
  const arEl = $('alignResult');
  if (arEl) { arEl.textContent = aligned?'2/2 ‚úì':'1/2 ‚úó'; arEl.style.color = aligned?'var(--green)':'var(--yellow)'; }
  setText('alignTag', aligned?`ALINHADO ${dir.toUpperCase()}`:'DIVERG√äNCIA');
  const atEl = $('alignTag');
  if (atEl) atEl.className = `tag ${aligned?(bear?'tag-red':'tag-green'):'tag-yellow'}`;

  // TF badges nos indicadores
  ['ind1','ind2','ind3','ind4','ind5'].forEach(id => {
    const el = $(id);
    if (el) el.innerHTML = tfs_arr.map((t,i) =>
      `<div class="ind-tf-badge ${i===0?'active-tf':''} ${t.cls==='bear'?'bear-tf':t.cls==='bull'?'bull-tf':''}">${t.tf}</div>`
    ).join('');
  });
  setText('indTFLabel', `Principal: ${tfs.principal||'4H'}`);

  // Score block
  const sn = $('scoreNumber');
  if (sn) { sn.textContent = sig.score||'‚Äî'; sn.style.color = scoreColor; }
  setText('scoreLabel', `/ 5 ¬∑ ${dir.toUpperCase()}${isWk?' ‚ö† WEEKEND':''}`);
  const sb = $('scoreBarFill');
  if (sb) { sb.style.width = `${(sig.score||0)*20}%`; sb.style.background = scoreColor; }

  const scoreItemsData = [
    ['SD Zone',    scr.sd,         sd.zone_type   || '‚Äî'],
    ['KEO v7',     scr.keo,        psig.type      || '‚Äî'],
    ['MM Kernel',  scr.mm_kernel,  mm.status      || '‚Äî'],
    ['Osc Matrix', scr.osc_matrix, osc.confluence != null ? (+osc.confluence).toFixed(2) : '‚Äî'],
    ['Stoch RSI',  scr.stoch_rsi,  `K:${(+(st.k||0)).toFixed(1)}`],
  ];
  const siEl = $('scoreItems');
  if (siEl) siEl.innerHTML = scoreItemsData.map(([label, val, sub]) =>
    `<div class="sc-item">
      <div><div class="sc-item-label">${label}</div><div class="sc-item-sub">${sub}</div></div>
      <div class="sc-item-val" style="color:${val?scoreColor:'var(--text3)'}">${val ? '‚úì' : '‚Äì'}</div>
    </div>`).join('');

  // gauges
  const pg = $('probFill');
  if (pg) { pg.style.width=`${prob}%`; pg.style.background=prob>=70?'var(--green)':prob>=50?'var(--yellow)':'var(--red)'; }
  setText('probValue', prob ? `${prob}%` : '‚Äî');
  if ($('probValue')) $('probValue').style.color = prob>=70?'var(--green)':prob>=50?'var(--yellow)':'var(--red)';

  const er = +(keo.er_kaufman||0);
  const eg = $('erFill');
  if (eg) { eg.style.width=`${Math.min(er*100,100)}%`; eg.style.background=er>=0.5?'var(--green)':'var(--yellow)'; }
  setText('erValue', er ? er.toFixed(2) : '‚Äî');
  if ($('erValue')) $('erValue').style.color = er>=0.5?'var(--green)':'var(--yellow)';

  const adx = +(mm.adx||0);
  const ag = $('adxFill');
  if (ag) { ag.style.width=`${Math.min(adx/50*100,100)}%`; ag.style.background=adx>=25?'var(--green)':'var(--yellow)'; }
  setText('adxValue', adx ? adx.toFixed(1) : '‚Äî');
  if ($('adxValue')) $('adxValue').style.color = adx>=25?'var(--green)':'var(--yellow)';

  // Analysis texts
  if (analysis && !analysis.error) {
    setText('analysisEstrutura', analysis.estrutura_smc || '‚Äî');
    setText('analysisMicro',     analysis.microestrutura || '‚Äî');
    setText('analysisRisco',     analysis.gestao_risco   || '‚Äî');

    const cEl = $('confluenceList');
    if (cEl) cEl.innerHTML = (analysis.confluencias||[]).length
      ? analysis.confluencias.map(c => `<div class="ab-list-item"><span class="ab-arrow c-green">‚ñ∏</span>${c}</div>`).join('')
      : '<div class="c-gray fs10">‚Äî</div>';

    const aEl = $('alertsList');
    if (aEl) aEl.innerHTML = (analysis.alertas||[]).length
      ? analysis.alertas.map(a => `<div class="ab-list-item"><span class="ab-arrow c-yellow">‚ö†</span>${a}</div>`).join('')
      : '<div class="c-gray fs10">‚Äî</div>';

    setText('tgContent', analysis.resumo_telegram || '‚Äî');
  } else if (analysis?.error) {
    setText('analysisEstrutura', `Erro na an√°lise: ${analysis.error}`);
  } else {
    setText('analysisEstrutura', 'An√°lise sendo processada...');
  }

  // Indicators right panel
  const indData = [
    {n:'indStatus1', val:scr.sd,         ok:!!scr.sd,         label:scr.sd?`‚úì ${sd.zone_type||'ATIVO'}`:'‚Äì INATIVO',  metric:`Zone: ${sd.zone_type||'none'}`},
    {n:'indStatus2', val:scr.keo,        ok:!!scr.keo,        label:scr.keo?`‚úì ${(psig.type||'‚Äî').toUpperCase()}`:'‚Äì INATIVO', metric:`ER: ${er.toFixed(2)}`},
    {n:'indStatus3', val:scr.mm_kernel,  ok:!!scr.mm_kernel,  label:scr.mm_kernel?`‚úì ${mm.status||'‚Äî'}`:'‚Äì INATIVO', metric:`ADX: ${adx.toFixed(1)}`},
    {n:'indStatus4', val:scr.osc_matrix, ok:!!scr.osc_matrix, label:scr.osc_matrix?'‚úì CONFLUENTE':'‚Äì INATIVO', metric:`MF: ${(+(osc.money_flow||0)).toFixed(2)}`},
    {n:'indStatus5', val:scr.stoch_rsi,  ok:!!scr.stoch_rsi,  label:scr.stoch_rsi?'‚úì ARMADO':'‚Äì INATIVO', metric:`K:${(+(st.k||0)).toFixed(1)} D:${(+(st.d||0)).toFixed(1)}`},
  ];
  indData.forEach(({n, ok, label, metric}) => {
    const el = $(n); if (el) { el.textContent = label; el.style.color = ok ? scoreColor : 'var(--text3)'; }
    const me = $(n.replace('Status','Metric')); if (me) me.textContent = metric;
  });

  // btn
  const btn = $('analyzeBtn');
  if (btn) { btn.className='analyze-btn'; btn.innerHTML='<span>‚ö° VER AN√ÅLISE APEX</span>'; }
}

function clearDashboard(a) {
  const asset = a ? a.name : '‚Äî';
  setText('signalPanelTitle', `AN√ÅLISE ATIVA ‚Äî ${asset}`);
  setText('signalScoreInline', '‚Äî');
  setText('currentPrice', '‚Äî');
  ['levelEntry','levelStop','levelTP1','levelTP2','levelTP3','levelRR','levelBias'].forEach(id => setText(id,'‚Äî'));
  setText('analysisEstrutura', 'Nenhum sinal recebido para este ativo ainda.');
  setText('tgContent', 'Aguardando sinal...');
  const btn = $('analyzeBtn');
  if (btn) { btn.className='analyze-btn blocked'; btn.innerHTML='<span>‚è≥ AGUARDANDO SINAL</span>'; }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BOTTOM PANELS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderRecentSignals(signals) {
  const el = $('recentSignals');
  if (!el) return;
  if (!signals.length) { el.innerHTML = '<div style="padding:14px;text-align:center;font-size:10px;color:var(--text3);">Nenhum sinal ainda.</div>'; return; }
  el.innerHTML = signals.map(s => {
    const bull = s.direction==='buy';
    let an = {}; try { an = JSON.parse(s.analysis||'{}'); } catch {}
    const ts = s.timestamp ? new Date(s.timestamp).toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'}) : '‚Äî';
    return `<div class="history-item" onclick="loadSignal(${s.id})">
      <div class="hi-dir" style="background:${bull?'rgba(0,229,160,.1)':'rgba(255,64,96,.1)'};color:${bull?'var(--green)':'var(--red)'}">${(s.direction||'?').toUpperCase()}</div>
      <div><div class="hi-asset">${s.asset}</div><div class="hi-tf">${ts}</div></div>
      <div class="hi-result c-text2">Score ${s.score}/5${an.probabilidade?`<br><span class="c-blue">Prob ${an.probabilidade}%</span>`:''}</div>
    </div>`;
  }).join('');
}

function renderAlertsFeed(signals) {
  const el = $('alertsFeed');
  if (!el) return;
  if (!signals.length) { el.innerHTML = '<div style="grid-column:1/-1;padding:18px;text-align:center;font-size:10px;color:var(--text3);">Aguardando sinais do TradingView...</div>'; return; }
  el.innerHTML = signals.map(s => {
    const bull=s.direction==='buy', bear=s.direction==='sell';
    const cls = bull?'premium':bear?'warning':'info';
    const em  = bull?'üü¢':bear?'üî¥':'‚ö™';
    let an = {}; try { an = JSON.parse(s.analysis||'{}'); } catch {}
    const ts = s.timestamp ? new Date(s.timestamp).toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'}) : '‚Äî';
    return `<div class="alert-card ${cls}" onclick="loadSignal(${s.id})">
      <div class="ac-title" style="color:${bull?'var(--green)':bear?'var(--red)':'var(--text2)'}">${em} ${(s.direction||'?').toUpperCase()} ‚Äî ${s.asset}</div>
      <div class="ac-desc">Score ${s.score}/5${an.probabilidade ? ` ¬∑ Prob ${an.probabilidade}%` : ''}</div>
      <div class="ac-time">${ts}</div>
    </div>`;
  }).join('');
}

function loadSignal(id) {
  const sig = lastSignals.find(s => s.id === id);
  if (!sig) return;
  const a = assets.find(x => x.name === sig.asset);
  if (a) activeId = a.id;
  renderAssetBar();
  renderSignal(sig);
  showView('dashboard', $('btnDash'));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MULTI-ASSETS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderMultiAssets() {
  const el = $('multiAssetGrid');
  if (!el) return;
  const byAsset = {};
  lastSignals.forEach(s => { if (!byAsset[s.asset]) byAsset[s.asset] = s; });
  const all = assets.filter(a => a.on);
  if (!all.length) return;
  el.innerHTML = all.map(a => {
    const sig = byAsset[a.name];
    const bull=sig?.direction==='buy', bear=sig?.direction==='sell';
    let an = {}; try { an = JSON.parse(sig?.analysis||'{}'); } catch {}
    const prob  = an.probabilidade || sig?.prob || 0;
    const score = sig?.score || '‚Äî';
    const sel   = a.id===activeId ? 'selected' : '';
    return `<div class="asset-card ${bull?'bull':bear?'bear':''} ${sel}" onclick="selectAsset(${a.id})">
      <span class="ac-score" style="color:${bull?'var(--green)':bear?'var(--red)':'var(--text3)'}">${score}</span>
      <div class="ac-name">${a.name}</div>
      <div class="ac-dir" style="color:${bull?'var(--green)':bear?'var(--red)':'var(--text3)'}">
        ${bull?'‚ñ≤ LONG':bear?'‚ñº SHORT':'‚Äì AGUARD.'}${prob ? ` ¬∑ ${prob}%` : ''}
      </div>
      <div class="ac-meta">${a.tf_p} / ${a.tf_c} / ${a.tf_e}${sig?` ¬∑ ${new Date(sig.timestamp).toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'})}`:''}</div>
    </div>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HIST√ìRICO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderHistory() {
  const dirFilter   = ($('histFilterDir')?.value   || '').toLowerCase();
  const assetFilter = $('histFilterAsset')?.value  || '';

  let sigs = [...lastSignals];
  if (dirFilter)   sigs = sigs.filter(s => s.direction === dirFilter);
  if (assetFilter) sigs = sigs.filter(s => s.asset === assetFilter);

  const statsEl = $('histStats');
  if (statsEl) {
    const total = lastSignals.length;
    const buys  = lastSignals.filter(s=>s.direction==='buy').length;
    const sells = lastSignals.filter(s=>s.direction==='sell').length;
    const probs = lastSignals.map(s=>s.prob).filter(Boolean);
    const avgP  = probs.length ? Math.round(probs.reduce((a,b)=>a+b,0)/probs.length) : 0;
    const avgS  = lastSignals.length ? (lastSignals.reduce((a,s)=>a+(s.score||0),0)/lastSignals.length).toFixed(1) : 0;
    statsEl.innerHTML = [
      ['TOTAL',       total,           'var(--text)'],
      ['LONG',        buys,            'var(--green)'],
      ['SHORT',       sells,           'var(--red)'],
      ['PROB M√âDIA',  avgP?`${avgP}%`:'‚Äî', 'var(--blue)'],
      ['SCORE M√âDIO', avgS,            'var(--yellow)'],
    ].map(([label,val,color]) => `
      <div style="padding:13px;background:var(--bg3);border:1px solid var(--border);text-align:center;">
        <div style="font-size:20px;font-weight:800;font-family:'Space Mono',monospace;color:${color}">${val}</div>
        <div style="font-size:8px;color:var(--text3);margin-top:3px;font-family:'Space Mono',monospace">${label}</div>
      </div>`).join('');
  }

  const tbody = $('historyTableBody');
  if (!tbody) return;
  if (!sigs.length) { tbody.innerHTML = '<div style="padding:18px;text-align:center;font-size:10px;color:var(--text3);">Nenhum sinal encontrado.</div>'; return; }
  tbody.innerHTML = sigs.map(s => {
    const bull = s.direction==='buy';
    const ts = s.timestamp ? new Date(s.timestamp).toLocaleString('pt-BR',{day:'2-digit',month:'2-digit',hour:'2-digit',minute:'2-digit'}) : '‚Äî';
    return `<div class="hist-row" onclick="loadSignal(${s.id})">
      <span style="color:${bull?'var(--green)':'var(--red)'};font-weight:700">${(s.direction||'?').toUpperCase()}</span>
      <span style="font-weight:700">${s.asset}</span>
      <span style="color:${s.score>=4?'var(--green)':s.score===3?'var(--yellow)':'var(--red)'}">${s.score}/5</span>
      <span class="mono fs9">${f2(s.entry)}</span>
      <span class="mono fs9 c-red">${f2(s.stop)}</span>
      <span class="mono fs9 c-green">${f2(s.tp1)}</span>
      <span class="c-blue">${s.prob ? s.prob+'%' : '‚Äî'}</span>
      <span class="mono fs9 c-gray">${ts}</span>
    </div>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TELEGRAM VIEW
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderTelegramView() {
  if (activeSignal) {
    let an = {}; try { an = JSON.parse(activeSignal.analysis||'{}'); } catch {}
    setText('tgViewContent', an.resumo_telegram || 'An√°lise ainda n√£o dispon√≠vel.');
  }
  const el = $('tgHistory');
  if (!el) return;
  if (!lastSignals.length) { el.innerHTML = '<div style="text-align:center;padding:18px;">Nenhum sinal ainda.</div>'; return; }
  el.innerHTML = lastSignals.slice(0,15).map(s => {
    let an = {}; try { an = JSON.parse(s.analysis||'{}'); } catch {}
    const bull = s.direction==='buy';
    const ts = s.timestamp ? new Date(s.timestamp).toLocaleString('pt-BR',{day:'2-digit',month:'2-digit',hour:'2-digit',minute:'2-digit'}) : '‚Äî';
    return `<div class="history-item" onclick="loadSignal(${s.id})" style="border-left:2px solid ${bull?'var(--green)':'var(--red)'}">
      <div><div class="hi-asset" style="color:${bull?'var(--green)':'var(--red)'}">${bull?'üü¢':'üî¥'} ${(s.direction||'?').toUpperCase()} ‚Äî ${s.asset}</div>
      <div class="hi-tf">${ts} ¬∑ Score ${s.score}/5${an.probabilidade ? ` ¬∑ Prob ${an.probabilidade}%` : ''}</div></div>
    </div>`;
  }).join('');
}

function copyTG() {
  const el = $('tgContent');
  if (el) navigator.clipboard.writeText(el.innerText).then(() => {
    const b = document.querySelectorAll('.tg-copy-btn')[0];
    if (b) { b.textContent='COPIADO!'; setTimeout(()=>b.textContent='COPIAR',2000); }
  });
}

function copyTGView() {
  const el = $('tgViewContent');
  if (el) navigator.clipboard.writeText(el.innerText).then(() => {
    const b = document.querySelectorAll('.tg-copy-btn')[1];
    if (b) { b.textContent='COPIADO!'; setTimeout(()=>b.textContent='COPIAR',2000); }
  });
}

function copyWebhookUrl() {
  const url = `${API_URL}/webhook`;
  navigator.clipboard.writeText(url).then(() => {
    const b = document.querySelector('.wb-copy');
    if (b) { b.textContent='COPIADO!'; setTimeout(()=>b.textContent='COPIAR',2000); }
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ANALYZE BUTTON
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function triggerAnalysis() {
  const btn = $('analyzeBtn');
  if (!btn) return;
  if (!activeSignal) {
    btn.innerHTML = '<span>‚ö† NENHUM SINAL RECEBIDO AINDA</span>';
    btn.className = 'analyze-btn blocked';
    setTimeout(() => { btn.innerHTML='<span>‚ö° VER AN√ÅLISE APEX</span>'; btn.className='analyze-btn'; }, 2500);
    return;
  }
  let an = {};
  try { an = JSON.parse(activeSignal.analysis || '{}'); } catch {}
  if (an && !an.error && an.estrutura_smc) {
    btn.innerHTML = '<span>‚ü≥ CARREGANDO...</span>';
    btn.className = 'analyze-btn loading';
    setTimeout(() => {
      renderSignal(activeSignal);
      const el = $('analysisEstrutura');
      if (el) el.scrollIntoView({behavior:'smooth', block:'start'});
      btn.innerHTML = '<span>‚úì AN√ÅLISE APEX CARREGADA</span>';
      btn.className = 'analyze-btn';
      setTimeout(() => { btn.innerHTML='<span>‚ö° VER AN√ÅLISE APEX</span>'; }, 2500);
    }, 400);
    return;
  }
  btn.innerHTML = '<span>‚ü≥ AN√ÅLISE SENDO PROCESSADA...</span>';
  btn.className = 'analyze-btn loading';
  setTimeout(() => { manualRefresh(); btn.innerHTML='<span>‚ö° VER AN√ÅLISE APEX</span>'; btn.className='analyze-btn'; }, 2000);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SETTINGS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function tfSelect(val, onChange) {
  return `<select class="cfg-select" onchange="${onChange}">${TF_OPT.map(t=>`<option${t===val?' selected':''}>${t}</option>`).join('')}</select>`;
}

function renderSettingsRows() {
  const el = $('assetConfigRows');
  if (!el) return;
  el.innerHTML = assets.map(a => `
    <div class="asset-config-row" style="grid-template-columns:110px 60px 60px 60px 55px 40px 32px;">
      <div style="font-size:10px;font-weight:700;">${a.name}<br><span class="mono fs9 c-gray">${a.cls}</span></div>
      ${tfSelect(a.tf_p, `setTF(${a.id},'tf_p',this.value)`)}
      ${tfSelect(a.tf_c, `setTF(${a.id},'tf_c',this.value)`)}
      ${tfSelect(a.tf_e, `setTF(${a.id},'tf_e',this.value)`)}
      <input class="cfg-input" type="number" value="${a.score}" min="1" max="5" style="text-align:center;" onchange="setTF(${a.id},'score',+this.value)">
      <div class="toggle-wrap"><button class="toggle ${a.on?'on':''}" onclick="toggleA(${a.id},this)"></button></div>
      <button class="nav-btn" style="padding:3px 6px;font-size:9px;border-color:rgba(255,64,96,.3);color:var(--red);" onclick="removeAsset(${a.id})">‚úï</button>
    </div>`).join('');

  const pr = $('presetRows');
  if (!pr) return;
  pr.innerHTML = CLASSES.map(cls => {
    const p = presets[cls];
    return `<div class="global-row">
      <div class="global-label">${cls}</div>
      <div class="global-ctrl">
        ${tfSelect(p.tf_p, `presets['${cls}'].tf_p=this.value`)}
        ${tfSelect(p.tf_c, `presets['${cls}'].tf_c=this.value`)}
        ${tfSelect(p.tf_e, `presets['${cls}'].tf_e=this.value`)}
        <button class="nav-btn" onclick="applyPreset('${cls}')">APLICAR</button>
      </div>
    </div>`;
  }).join('');
}

function setTF(id, field, val) {
  const a = assets.find(x => x.id === id);
  if (a) { a[field] = val; saveConfig(); renderAssetBar(); if (id===activeId && a.latestSignal) renderSignal(a.latestSignal); }
}

function toggleA(id, btn) {
  const a = assets.find(x => x.id === id);
  if (a) { a.on = !a.on; btn.classList.toggle('on'); saveConfig(); renderAssetBar(); }
}

function applyPreset(cls) {
  const p = presets[cls];
  assets.filter(a => a.cls === cls).forEach(a => { a.tf_p=p.tf_p; a.tf_c=p.tf_c; a.tf_e=p.tf_e; });
  saveConfig(); renderSettingsRows(); renderAssetBar();
}

function showAddRow() { $('addRow').style.display='flex'; $('newAssetInput').focus(); }

function addAsset() {
  const name = $('newAssetInput').value.trim().toUpperCase();
  const cls  = $('newClass').value;
  if (!name) return;
  const p = presets[cls] || {tf_p:'4H',tf_c:'1H',tf_e:'15m'};
  assets.push({id:Date.now(), name, cls, tf_p:p.tf_p, tf_c:p.tf_c, tf_e:p.tf_e, score:3, on:true, bias:'neutral'});
  $('newAssetInput').value = '';
  $('addRow').style.display='none';
  saveConfig(); renderSettingsRows(); renderAssetBar();
}

function removeAsset(id) {
  assets = assets.filter(a => a.id !== id);
  if (activeId === id) activeId = assets.find(a => a.on)?.id || 1;
  saveConfig(); renderSettingsRows(); renderAssetBar();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showView(name, btn) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  const view = $(`view-${name}`);
  if (view) view.classList.add('active');
  if (btn)  btn.classList.add('active');
  if (name==='settings') renderSettingsRows();
  if (name==='history')  renderHistory();
  if (name==='ativos')   renderMultiAssets();
  if (name==='telegram') renderTelegramView();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PERSISTENCE (localStorage)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const STORAGE_KEY = 'apex_hub_config_v3';

function saveConfig() {
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify({
      assets: assets.map(a => ({id:a.id,name:a.name,cls:a.cls,tf_p:a.tf_p,tf_c:a.tf_c,tf_e:a.tf_e,score:a.score,on:a.on})),
      presets, activeId
    }));
  } catch(e) { console.warn('saveConfig:', e); }
}

function loadConfig() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return;
    const cfg = JSON.parse(raw);
    if (cfg.assets?.length) {
      cfg.assets.forEach(saved => {
        const a = assets.find(x => x.id===saved.id || x.name===saved.name);
        if (a) {
          a.tf_p=saved.tf_p||a.tf_p; a.tf_c=saved.tf_c||a.tf_c; a.tf_e=saved.tf_e||a.tf_e;
          a.score=saved.score||a.score; a.on=saved.on!==undefined?saved.on:a.on; a.id=saved.id;
        } else {
          assets.push({...saved, bias:'neutral'});
        }
      });
    }
    if (cfg.presets)  Object.assign(presets, cfg.presets);
    if (cfg.activeId) activeId = cfg.activeId;
  } catch(e) { console.warn('loadConfig:', e); }
}

function resetConfig() {
  if (!confirm('Resetar todas as configura√ß√µes para o padr√£o?')) return;
  localStorage.removeItem(STORAGE_KEY);
  location.reload();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
loadConfig();
renderAssetBar();
tick();
setInterval(tick, 30000);
setConn('connecting');
pollBackend();
fetchStats();
setInterval(fetchStats, 60000);
</script>
</body>
</html>
